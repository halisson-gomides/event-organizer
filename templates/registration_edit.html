{% extends "base.html" %}
{% block title %}SolicitaÃ§Ãµes de Registro{% endblock %}
{% block content %}

<div class="action-bar">
  <h2>ğŸ“‹ SolicitaÃ§Ãµes de Registro</h2>
</div>

<div class="modal">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <h3 style="margin: 0;">ğŸ” Revisar SolicitaÃ§Ã£o</h3>
    <button hx-get="/registrations" hx-target="body" hx-swap="outerHTML"
      style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6c757d;">
      âœ•
    </button>
  </div>

  <div class="list-type {{ registration_request.status }}" style="text-align: center; margin-bottom: 1.5rem; border-radius: 6px;">
    {% if registration_request.status == 'pending' %}
      â³ PENDENTE
    {% elif registration_request.status == 'approved' %}
      âœ… APROVADO
    {% elif registration_request.status == 'rejected' %}
      âŒ REJEITADO
    {% endif %}
  </div>

  <form hx-patch="/registrations/{{ registration_request.id }}/update"
        hx-target="body"
        hx-swap="outerHTML">
    
    <label>
      UsuÃ¡rio *
      <input type="text" 
             id="username" 
             name="username" 
             value="{{ registration_request.username }}"
             required 
             maxlength="50"
             {% if registration_request.status != 'pending' %}disabled{% endif %}>
    </label>

    <label>
      Email *
      <input type="email" 
             id="email" 
             name="email" 
             value="{{ registration_request.email }}"
             required 
             maxlength="100"
             {% if registration_request.status != 'pending' %}disabled{% endif %}>
    </label>

    <label>
      Perfil
      <select id="profile" 
              name="profile"
              {% if registration_request.status != 'pending' %}disabled{% endif %}>
        <option value="" {% if not registration_request.profile %}selected{% endif %}>Selecione um perfil</option>
        <option value="admin" {% if registration_request.profile == 'admin' %}selected{% endif %}>Administrador</option>
        <option value="organizer" {% if registration_request.profile == 'organizer' %}selected{% endif %}>Organizador</option>
        <option value="volunteer" {% if registration_request.profile == 'volunteer' %}selected{% endif %}>VoluntÃ¡rio</option>
      </select>
    </label>

    <label>
      ğŸ“… Solicitado em
      <input type="text" 
             value="{{ registration_request.requested_at|to_local_time }}"
             disabled>
    </label>

    {% if registration_request.reviewed_at %}
      <label>
        ğŸ” Revisado em
        <input type="text" 
               value="{{ registration_request.reviewed_at|to_local_time }}"
               disabled>
      </label>
    {% endif %}

    {% if registration_request.status == 'pending' %}
      <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1rem;">
        <button type="button" hx-get="/registrations" hx-target="body" hx-swap="outerHTML">
          Voltar
        </button>
        <button type="submit">
          <span>ğŸ’¾ Salvar AlteraÃ§Ãµes</span>
        </button>
      </div>
    {% endif %}
  </form>

  {% if registration_request.status == 'pending' %}
    <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid #e9ecef;">
    
    <form hx-post="/registrations/{{ registration_request.id }}/approve" 
            hx-target="body" 
            hx-swap="outerHTML"
            hx-confirm="Tem certeza que deseja aprovar esta solicitaÃ§Ã£o?">
      <div style="display: flex; gap: 1rem; justify-content: center;">
        <input type="hidden" name="username" value="{{ registration_request.username }}">
        <input type="hidden" name="email" value="{{ registration_request.email }}">
        <input type="hidden" name="profile" value="{{ registration_request.profile or '' }}">
        
        <button type="button" 
                class="btn-small btn-delete"
                onclick="document.getElementById('reject-form').style.display='block'; this.style.display='none';">
          âŒ Rejeitar
        </button>      
        <button type="submit">
          âœ… Aprovar
        </button>
      </div>
    </form>

    <form id="reject-form" 
          style="display: none; margin-top: 1.5rem;"
          hx-post="/registrations/{{ registration_request.id }}/reject" 
          hx-target="body" 
          hx-swap="outerHTML">
      <label>
        Motivo da RejeiÃ§Ã£o (opcional)
        <textarea id="rejection_reason" 
                  name="rejection_reason" 
                  rows="3"
                  placeholder="Explique o motivo da rejeiÃ§Ã£o..."></textarea>
      </label>
      <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 1rem;">
        <button type="button" 
                class="btn-secondary"
                onclick="document.getElementById('reject-form').style.display='none'; document.querySelector('.btn-danger').style.display='inline-block';">
          Cancelar
        </button>
        <button type="submit" class="btn-delete">
          Confirmar RejeiÃ§Ã£o
        </button>
      </div>
    </form>
  {% elif registration_request.status == 'rejected' and registration_request.rejection_reason %}
    <div class="error" style="margin-top: 1.5rem;">
      <strong>â— Motivo da RejeiÃ§Ã£o:</strong>
      <p style="margin: 0.5rem 0 0 0;">{{ registration_request.rejection_reason }}</p>
    </div>
  {% endif %}
</div>
{% endblock %}